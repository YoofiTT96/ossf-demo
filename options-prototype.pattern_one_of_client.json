{
  "$schema": "https://calm.finos.org/release/1.0-rc1/meta/calm.json",
  "$id": "https://calm.finos.org/release/1.0-rc1/prototype/oneof/options-prototype.pattern.json",
  "title": "Application A/B/C + Database Pattern",
  "type": "object",
  "properties": {
    "nodes": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "prefixItems": [
        {
          "oneOf": [
            {
              "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/node",
              "type": "object",
              "properties": {
                "unique-id": {
                  "const": "spa"
                },
                "name": {
                  "const": "React Single Page Application"
                },
                "description": {
                  "const": "Single Page React Application"
                },
                "node-type": {
                  "const": "webclient"
                },
                "metadata": {
                    "const": [
                        {
                            "technology": ["ReactJS", "Javascript"]
                        }
                    ]
                }
              }
            },
            {
              "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/node",
              "type": "object",
              "properties": {
                "unique-id": {
                  "const": "consumer-service"
                },
                "name": {
                  "const": "Consumer Service"
                },
                "description": {
                  "const": "Consumer Service, optionally used in this architecture"
                },
                "node-type": {
                  "const": "service"
                },
                "metadata": {
                    "const": [
                        {
                            "technology": ["SpringBoot", "Java"]
                        }
                    ]
                }
              }
            }
          ]
        },
        {
          "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/node",
          "type": "object",
          "properties": {
            "unique-id": {
              "const": "producer-service"
            },
            "name": {
              "const": "Producer Service"
            },
            "description": {
              "const": "Application to provide updates on results and stats"
            },
            "node-type": {
              "const": "service"
            }
          }
        },
        {
          "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/node",
          "type": "object",
          "properties": {
            "unique-id": {
              "const": "database"
            },
            "name": {
              "const": "Database"
            },
            "description": {
              "const": "Database used by Producer Service"
            },
            "node-type": {
              "const": "database"
            }
          }
        }
      ]
    },
    "relationships": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "prefixItems": [
        {
          "oneOf": [
            {
              "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/relationship",
              "type": "object",
              "properties": {
                "unique-id": {
                  "const": "spa-to-producer-service"
                },
                "description": {
                  "const": "React Application connects to Producer Service"
                },
                "relationship-type": {
                  "const": {
                    "connects": {
                      "source": { "node": "spa" },
                      "destination": { "node": "producer-service" }
                    }
                  }
                }
              }
            },
            {
              "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/relationship",
              "type": "object",
              "properties": {
                "unique-id": {
                  "const": "application-b-to-producer-service"
                },
                "description": {
                  "const": "Consumer Service connects to Producer Service"
                },
                "relationship-type": {
                  "const": {
                    "connects": {
                      "source": { "node": "application-b" },
                      "destination": { "node": "producer-service" }
                    }
                  }
                }
              }
            }
          ]
        },
        {
          "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/relationship",
          "type": "object",
          "properties": {
            "unique-id": {
              "const": "producer-service-to-database"
            },
            "description": {
              "const": "Producer Service connects to the Database"
            },
            "relationship-type": {
              "const": {
                "connects": {
                  "source": { "node": "producer-service" },
                  "destination": { "node": "database" }
                }
              }
            }
          }
        },
        {
          "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/relationship",
          "type": "object",
          "properties": {
            "unique-id": {
                "const": "connection-options"
            },
            "description": {
                "const": "The choice of nodes and relationships in the pattern"
            },
            "relationship-type": {
              "type": "object",
              "properties": {
                "options": {
                    "type": "array",
                    "minItems": 1,
                    "maxItems": 1,
                    "prefixItems": [
                      {
                        "oneOf": [
                          {
                            "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/decision",
                            "type": "object",
                            "properties": {
                              "description": {
                                "const": "React Application connects to Producer Service"
                              },
                              "nodes": {
                                "const": [
                                  "spa"
                                ]
                              },
                              "relationships": {
                                "const": [
                                  "spa-to-producer-service"
                                ]
                              }
                            }
                          },
                          {
                            "$ref": "https://calm.finos.org/release/1.0-rc1/meta/core.json#/defs/decision",
                            "type": "object",
                            "properties": {
                              "description": {
                                "const": "Application B connects to Producer Service"
                              },
                              "nodes": {
                                "const": [
                                  "application-b"
                                ]
                              },
                              "relationships": {
                                "const": [
                                  "application-b-to-producer-service"
                                ]
                              }
                            }
                          }
                        ]
                      }
                    ]
                  }
              }
            }
          }
        }
      ]
    }
  },
  "required": [
    "nodes",
    "relationships"
  ]
}